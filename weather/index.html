<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢å¤©æ°— - ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆå¤©æ°—</title>

<style>
  body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: #eef2f3;
    padding: 16px;
  }

  .card {
    background: white;
    border-radius: 14px;
    padding: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
  }

  h2 {
    text-align: center;
    margin-top: 0;
  }

  input, button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    font-size: 16px;
    border-radius: 10px;
    border: 1px solid #ccc;
  }

  button {
    background: #2563eb;
    color: white;
    border: none;
    cursor: pointer;
  }

  button:hover {
    opacity: 0.9;
  }

  .outdoor-alert {
    padding: 12px;
    border-radius: 10px;
    color: white;
    font-weight: bold;
    margin-top: 10px;
    text-align: center;
  }

  .ok { background: #16a34a; }      /* è¡Œã‘ã‚‹ï¼ˆç·‘ï¼‰ */
  .warn { background: #f59e0b; }    /* æ³¨æ„ï¼ˆé»„ï¼‰ */
  .danger { background: #dc2626; }  /* å±é™ºï¼ˆèµ¤ï¼‰ */

  .row {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
  }
</style>

</head>
<body>

<div class="card">
  <h2>ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢å¤©æ°—ï¼ˆãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆï¼‰</h2>

  <input id="place" type="text" placeholder="ä¾‹ï¼šå¯Œå£«å±±å±±é ‚ã€ã€‡ã€‡ã‚­ãƒ£ãƒ³ãƒ—å ´ã€æ²³å·æ•·ãªã©">
  <button onclick="getWeather()">å¤©æ°—ã‚’èª¿ã¹ã‚‹</button>

  <div id="result"></div>
</div>

<script>
async function getWeather() {
  const place = document.getElementById("place").value;
  if (!place) return alert("å ´æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  document.getElementById("result").innerHTML = "æ¤œç´¢ä¸­â€¦";

  // â‘ ç·¯åº¦çµŒåº¦ã®å–å¾—
  const geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(place)}&count=1&language=ja`;
  const geoRes = await fetch(geoUrl);
  const geo = await geoRes.json();

  if (!geo.results) {
    document.getElementById("result").innerHTML = "å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
    return;
  }

  const { latitude, longitude, elevation } = geo.results[0];

  // â‘¡å¤©æ°—ã®å–å¾—
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,wind_speed_10m&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto`;
  const res = await fetch(url);
  const data = await res.json();

  const w = data.daily;
  const current = data.current;

  // å±é™ºåº¦è¨ˆç®—ï¼ˆé¢¨é€Ÿ Ã— æ°—æ¸© Ã— å¤©æ°—ã‚³ãƒ¼ãƒ‰ï¼‰
  let dangerLevel = "ok";
  if (current.wind_speed_10m >= 8) dangerLevel = "warn";
  if (current.wind_speed_10m >= 12) dangerLevel = "danger";
  if ([65,71,95].includes(w.weathercode[0])) dangerLevel = "danger"; // å¼·é›¨ãƒ»é›ªãƒ»é›·

  const weatherText = {
    0:"â˜€ï¸ å¿«æ™´",1:"ğŸŒ¤ æ™´ã‚Œ",2:"â›…",3:"â˜ï¸",
    51:"ğŸŒ¦ å°é›¨",61:"ğŸŒ§ é›¨",65:"ğŸŒ§ å¼·é›¨",71:"â„ï¸ é›ª",95:"â›ˆ é›·"
  };

  document.getElementById("result").innerHTML = `
    <div class="outdoor-alert ${dangerLevel}">
      ${
        dangerLevel === "ok" ? "ğŸŸ¢ è‰¯å¥½ï¼šã‚¢ã‚¦ãƒˆãƒ‰ã‚¢æ—¥å’Œï¼" :
        dangerLevel === "warn" ? "ğŸŸ¡ æ³¨æ„ï¼šé¢¨ãŒå¼·ã‚ã§ã™" :
        "ğŸ”´ å±é™ºï¼šå¼·é¢¨/é›·ã®å¯èƒ½æ€§ã‚ã‚Š"
      }
    </div>

    <div class="row"><b>å¤©æ°—ï¼š</b> ${weatherText[w.weathercode[0]]}</div>
    <div class="row"><b>ç¾åœ¨ã®æ°—æ¸©ï¼š</b> ${current.temperature_2m}Â°C</div>
    <div class="row"><b>æœ€é«˜æ°—æ¸©ï¼š</b> ${w.temperature_2m_max[0]}Â°C</div>
    <div class="row"><b>æœ€ä½æ°—æ¸©ï¼š</b> ${w.temperature_2m_min[0]}Â°C</div>
    <div class="row"><b>é¢¨é€Ÿï¼š</b> ${current.wind_speed_10m} m/s</div>
    <div class="row"><b>æ¨™é«˜ï¼š</b> ${elevation || "ä¸æ˜"} m</div>
  `;
}
</script>

</body>
</html>
