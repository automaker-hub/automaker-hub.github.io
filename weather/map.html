<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ°å›³ã§å¤©æ°—ã‚’èª¿ã¹ã‚‹</title>

  <!-- Leafletåœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body { margin:0; }
    #map { height: 60vh; }
    #result { padding: 15px; font-size: 16px; }
  </style>
</head>
<body>

<h2 style="padding:10px;">åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ãã®åœ°ç‚¹ã®å¤©æ°—ã‚’è¡¨ç¤º</h2>

<div id="map"></div>
<div id="result">åœ°ç‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</div>

<script>
// â‘  åœ°å›³ã®åˆæœŸè¡¨ç¤º
const map = L.map('map').setView([35.6804, 139.7690], 10); // æ±äº¬

// ã‚¿ã‚¤ãƒ«ï¼ˆç„¡æ–™ã§OKï¼‰
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let marker;

// â‘¡ åœ°å›³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
map.on('click', async function(e) {
  const lat = e.latlng.lat;
  const lon = e.latlng.lng;

  if (marker) map.removeLayer(marker);
  marker = L.marker([lat, lon]).addTo(map);

  document.getElementById("result").innerHTML = "å¤©æ°—ã‚’å–å¾—ä¸­â€¦";

  // â‘¢ Open-Meteo å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto`;
  const res = await fetch(url);
  const data = await res.json();

  const w = data.daily;

  const weatherCodeMap = {
    0:"â˜€ï¸ å¿«æ™´",1:"ğŸŒ¤ æ™´ã‚Œ",2:"â›…",3:"â˜ï¸",
    45:"ğŸŒ«",48:"ğŸŒ«",51:"ğŸŒ¦",61:"ğŸŒ§",63:"ğŸŒ§",65:"ğŸŒ§",71:"â„ï¸",95:"â›ˆ"
  };

  const text = `
    <h3>é¸æŠã—ãŸåœ°ç‚¹ã®å¤©æ°—</h3>
    <p><strong>ä»Šæ—¥:</strong> ${weatherCodeMap[w.weathercode[0]]}</p>
    <p>æœ€é«˜æ°—æ¸©: ${w.temperature_2m_max[0]}Â°C</p>
    <p>æœ€ä½æ°—æ¸©: ${w.temperature_2m_min[0]}Â°C</p>
    <p>ç·¯åº¦: ${lat.toFixed(5)}, çµŒåº¦: ${lon.toFixed(5)}</p>
  `;

  document.getElementById("result").innerHTML = text;
});
</script>

</body>
</html>
